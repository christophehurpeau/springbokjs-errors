{"version":3,"sources":["../src/HtmlRenderer.js"],"names":[],"mappings":"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","file":"HtmlRenderer.js","sourcesContent":["// jscs:disable maximumLineLength\n\nimport escape from 'escape-html';\nimport highlight from 'eshighlight-fb';\nimport { parseErrorStack } from './index';\nimport StackTrace from './StackTrace';\n\nexport default class HtmlRenderer {\n    constructor(options) {\n        this.options = Object.assign({\n            fileProtocol: 'file',\n        }, options);\n    }\n\n    openLocalFile(filePath, lineNumber, columnNumber, realFilePath) {\n        if (this.openLocalFile.generatedPath && this.openLocalFile.sourcePath\n                     && filePath.startsWith(this.openLocalFile.generatedPath)) {\n            filePath = this.openLocalFile.sourcePath + filePath.substr(this.openLocalFile.generatedPath.length);\n        }\n\n        return `<a download href=\"${this.options.fileProtocol}://${escape(realFilePath || filePath)}`\n               + `${!lineNumber ? '' : `?${lineNumber}${!columnNumber ? '' : `:${columnNumber}`}`}\">`;\n    }\n\n    replaceAppInFilePath(filePath) {\n        if (this.openLocalFile.generatedPath) {\n            filePath = `APP/${filePath.substr(this.openLocalFile.generatedPath.length)}`;\n        }\n\n        return filePath;\n    }\n\n    render(error) {\n        let str = '<div style=\"text-align: left\">';\n        str += `<h4>${error.name}</h4>\\n`;\n        if (error.message) {\n            str += '<pre style=\"background:#FFF;color:#222;border:0;font-size:1em;white-space:pre-wrap;word-wrap:break-word\">';\n            str += escape(error.message);\n            str += '</pre>';\n        }\n\n        str += '<h5 style=\"background:#FFDDAA;color:#333;border:1px solid #E07308;padding:1px 2px;\">Call Stack:</h5>' + '\\n';\n\n        if (!this.options.production) {\n            str += `<pre style=\"background:#FFF;color:#222;border:0\">${this.renderStack(error)}</pre>`;\n        }\n\n        return str;\n    }\n\n    renderStack(error) {\n        let stackTrace = error.stackTrace instanceof StackTrace ? error.stackTrace : parseErrorStack(error);\n\n        let str = `<style>.string{ color: #EC7600; }\n.keyword, .null{ font-weight: bold; color: #93C763; }\n.numeric{ color: #FACD22; }\n.line-comment{ color: #66747B; }\n.identifier{ }\n.control-flow{ color: #93C763; }\n.azerty1{ color: #66747B; }\n.azerty2{ color: #678CB1; }\n.azerty5{ color: #F1F2F3; }\n.azerty6{ color: #8AC763; }\n.azerty7{ color: #E0E2E4; }\n.azerty9{ color: purple; }\n</style>`;\n        stackTrace.forEach((item, i) => {\n            if ((item.file && item.file.contents) || item.compiledFileName) {\n                str += '<span><a href=\"javascript:;\" style=\"color:#CC7A00;text-decoration:none;outline:none;\" '\n                        + 'onclick=\"var el=this.parentNode.nextElementSibling; el.style.display=el.style.display==\\'none\\'?\\'block\\':\\'none\\';\">';\n            }\n\n            str += `#${i} `;\n            if (item.fileName && item.fileName.startsWith('/')) {\n                str += this.openLocalFile(item.fileName, item.lineNumber, item.columnNumber, item.realFileName);\n            }\n\n            if (!item.native) {\n                str += this.replaceAppInFilePath(item.realFileName || item.fileName);\n                str += `:${item.lineNumber}:${item.columnNumber}`;\n            }\n\n            if (item.fileName) {\n                str += '</a> ';\n            }\n\n            if (item.functionName) {\n                str += item.functionName;\n            } else if (item.typeName) {\n                str += `${item.typeName}.${item.methodName || '<anonymous>'}`;\n            }\n\n            if (item.native) {\n                str += ' [native]';\n            }\n\n            if ((item.file && item.file.contents) || item.compiledFileName) {\n                str += '</a></span>';\n                str += '<div style=\"display:none\">';\n                if (item.compiledFileName) {\n                    str += '<div style=\"margin-top: 5px\">';\n                    str += '<b>Compiled path :</b><br />';\n                    if (item.realCompiledFileName && item.realCompiledFileName.startsWith('/')) {\n                        str += this.openLocalFile(item.compiledFileName, item.compiledLineNumber,\n                                item.compiledColumnNumber, item.realCompiledFileName);\n                    }\n\n                    str += this.replaceAppInFilePath(item.realCompiledFileName);\n                    str += `:${item.compiledLineNumber}:${item.compiledColumnNumber}`;\n                    if (item.realCompiledFileName && item.realCompiledFileName.startsWith('/')) {\n                        str += '</a>';\n                    }\n\n                    str += '</div>';\n                }\n\n                if (item.file && item.file.contents) {\n                    str += '<div style=\"margin-top: 5px\">';\n                    str += '<b>File content :</b><br />';\n                    str += this.highlightLine(item.file.contents, item.lineNumber, item.columnNumber);\n                    str += '</div>';\n                }\n\n                str += '</div>';\n            }\n\n            str += '\\n';\n        });\n\n        return str;\n    }\n\n    highlightLine(contents, lineNumber /* , columnNumber */) {\n        let style = 'background:#3F1F1F;';\n        let withLineNumbers = true;\n        let minmax = 4;\n\n        let hcontents;\n        try {\n            hcontents = highlight(contents);\n        } catch (err) {\n            hcontents = escape(contents);\n        }\n\n        hcontents = hcontents.split(/\\r\\n|\\n\\r|\\n|\\r/);\n\n        let ok = lineNumber <= hcontents.length;\n        let firstLine;\n        let start;\n        let lineContent;\n        let end;\n\n        if (ok) {\n            firstLine = Math.max(0, minmax ? lineNumber - 1 - minmax : 0);\n            start = hcontents.slice(firstLine, lineNumber - 1);\n            lineContent = lineNumber === 0 ? '' : hcontents[lineNumber - 1];\n            end = hcontents.slice(lineNumber, lineNumber + minmax);\n        } else {\n            start = hcontents;\n        }\n\n        /* if (withLineNumbers) {\n            // $withLineNumbers = '%'.strlen((string)($ok ? $line+$minmax : $minmax+1)).'d';\n        } */\n\n        let content = this.lines(withLineNumbers, ok ? firstLine + 1 : 1, start);\n        if (ok) {\n            let attributes = { style: style };\n            content += this.line(withLineNumbers, lineNumber, attributes, lineContent);\n            content += this.lines(withLineNumbers, lineNumber + 1, end);\n        }\n\n        let preAttrs = { style: 'background:#0F0F0F;color:#E0E2E4;border:0;padding:0;position:relative;' };\n        return this.tag('pre', preAttrs, content, false);\n    }\n\n    lines(withLineNumbers, startNumber, _lines) {\n        let content = '';\n        _lines.forEach((line) => {\n            content += this.line(withLineNumbers, startNumber++, {}, line);\n        });\n        return content;\n    }\n\n    line(withLineNumbers, lineNumber, attributes, contentLine) {\n        attributes.style = `${attributes.style || ''}white-space:pre-wrap;`\n            + `${withLineNumbers ? 'padding-left:20px;' : ''}`;\n\n        if (withLineNumbers) {\n            contentLine = `<i style=\"color:#AAA;font-size:7pt;position:absolute;left:1px;padding-top:1px;\">`\n                            + `${lineNumber}</i>${contentLine}`;\n        }\n\n        return this.tag('div', attributes, contentLine);\n    }\n\n    tag(tagName, attributes, content, contentEscape) {\n        attributes = attributes || {};\n        let str = '';\n        for (let key in attributes) {\n            str += ` ${key}`;\n            if (attributes[key]) {\n                str += `=\"${attributes[key] === true ? key : escape(attributes[key])}\"`;\n            }\n        }\n\n        return `<${tagName}${str}${content == null ? '/' :\n                    `>${contentEscape ? escape(content) : content}</${tagName}` }>`;\n    }\n}\n"]}